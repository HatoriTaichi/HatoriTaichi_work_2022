//=============================================================================
//
// 背景処理 [bg.h]
// Author : 羽鳥太一
//
//=============================================================================
//=============================================================================
// インクルード
//=============================================================================
#include "bg.h"

//=============================================================================
// デフォルトコンストラクタ
//=============================================================================
CBg::CBg(CObject::PRIORITY Priority) : CObject3D(Priority)
{
	m_uv_move_speed = D3DXVECTOR2(0.0f, 0.0f);
	m_uv_pos = D3DXVECTOR2(0.0f, 0.0f);
}

//=============================================================================
// デフォルトデストラクタ
//=============================================================================
CBg::~CBg()
{

}

//=============================================================================
// 初期化
//=============================================================================
HRESULT CBg::Init(void)
{	
	// 3Dポリゴンを初期化
	CObject3D::Init();

	// オブジェクトタイプの設定
	SetObjType(CObject::OBJTYPE::BG);

	// ライトの影響を受けない
	SetLighting(false);

	return S_OK;
}

//=============================================================================
// 終了
//=============================================================================
void CBg::Uninit(void)
{
	// 破棄
	CObject3D::Uninit();
}

//=============================================================================
// 更新
//=============================================================================
void CBg::Update(void)
{
	// テクスチャ座標を動かす
	m_uv_pos += m_uv_move_speed;

	// テクスチャ座標の設定
	SetTex(m_uv_pos.x, m_uv_pos.y);

	// テクスチャ座標をループさせる
	if (m_uv_pos.x < 0.0f)
	{
		m_uv_pos.x += 1.0f;
	}
	else if (m_uv_pos.x > 1.0f)
	{
		m_uv_pos.x -= 1.0f;
	}
	if (m_uv_pos.y < 0.0f)
	{
		m_uv_pos.y += 1.0f;
	}
	else if (m_uv_pos.y > 1.0f)
	{
		m_uv_pos.y -= 1.0f;
	}
}

//=============================================================================
// 描画
//=============================================================================
void CBg::Draw(void)
{
	// 描画
	CObject3D::Draw();
}

//=============================================================================
// 生成
//=============================================================================
CBg *CBg::Create(const D3DXVECTOR3 & pos, const D3DXVECTOR3 & size, const D3DXVECTOR3 & rot, D3DXVECTOR2 uv_move_speed)
{
	CBg *bg = nullptr;	// BGのポインタ

	// nullptrなら
	if (bg == nullptr)
	{
		// 生成
		bg = new CBg;

		// 生成されていたら
		if (bg != nullptr)
		{
			// 引数の代入
			bg->m_pos = pos;
			bg->m_size = size;
			bg->m_rot = rot;
			bg->m_uv_move_speed = uv_move_speed;

			// 初期化
			bg->Init();
		}
	}

	return bg;
}
